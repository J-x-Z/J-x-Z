name: GitHub-Profile-3D-Contrib

on:
  schedule:
    - cron: "0 18 * * *"  # æ¯å¤©UTC 18:00è¿è¡Œï¼ˆåŒ—äº¬æ—¶é—´å‡Œæ™¨2ç‚¹ï¼‰
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    name: generate-github-profile-3d-contrib
    steps:
      - uses: actions/checkout@v3
        with:
          fetch-depth: 0  # è·å–å®Œæ•´å†å²
      
      # ğŸ†• å¤‡ç”¨è‡ªåŠ¨commitï¼ˆå¦‚æœsnake.ymlæ²¡æœ‰è§¦å‘ï¼‰
      - name: Backup daily commit
        run: |
          # é…ç½®gitç”¨æˆ·ä¿¡æ¯
          git config user.name "J-x-Z"
          git config user.email "39978180+J-x-Z@users.noreply.github.com"
          
          # æ£€æŸ¥ä»Šå¤©æ˜¯å¦å·²ç»æœ‰commit
          TODAY=$(date -u +%Y-%m-%d)
          COMMITS_TODAY=$(git log --since="$TODAY 00:00:00" --until="$TODAY 23:59:59" --author="J-x-Z" --oneline | wc -l)
          
          if [ "$COMMITS_TODAY" -eq 0 ]; then
            echo "ğŸ“ Creating backup commit..."
            mkdir -p logs
            echo "- ğŸ™ï¸ 3D profile generated at $(date '+%Y-%m-%d %H:%M:%S UTC')" >> logs/3d-activity.md
            git add logs/3d-activity.md
            git commit -m "chore: 3D profile update" || echo "Nothing to commit"
            git push origin main || echo "Push failed"
          else
            echo "âœ… Already have commits today"
          fi
      
      # åŸæœ‰çš„3Då›¾ç”Ÿæˆæ­¥éª¤
      - uses: yoshi389111/github-profile-3d-contrib@0.7.1
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          USERNAME: ${{ github.repository_owner }}
      
      # ä¿®æ”¹commité…ç½®ï¼Œä½¿ç”¨ä½ çš„ç”¨æˆ·ä¿¡æ¯
      - name: Commit & Push
        run: |
          git config user.name "J-x-Z"
          git config user.email "39978180+J-x-Z@users.noreply.github.com"
          git add -A .
          git commit -m "chore: update 3D profile" || echo "No changes to commit"
          git push
